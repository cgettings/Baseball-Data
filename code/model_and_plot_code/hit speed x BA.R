###########################################################################################-
###########################################################################################-
##
## Hit Speed x Batting Average ----
##
###########################################################################################-
###########################################################################################-

#=========================================================================================#
# Setting up ----
#=========================================================================================#

#-----------------------------------------------------------------------------------------#
# Loading libraries
#-----------------------------------------------------------------------------------------#

library(tidyverse)
library(lubridate)
library(dbplyr)
library(DBI)
library(RSQLite)
library(glue)

#-----------------------------------------------------------------------------------------#
# Connecting to database
#-----------------------------------------------------------------------------------------#

statcast_db <- dbConnect(SQLite(), "data/statcast_db_rebuilt.sqlite3")

#-----------------------------------------------------------------------------------------#
# Pulling data from database ----
#-----------------------------------------------------------------------------------------#

statcast_data <-
    statcast_db %>% 
    tbl("statcast_data") %>%
    filter(type == "X") %>%
    select(game_date, 
           game_year,
           ballpark,
           bb_type,
           player_name,
           hit_distance_sc,
           launch_speed,
           woba_value,
           babip_value
    ) %>% 
    filter(!is.na(launch_speed)) %>% 
    collect() %>% 
    mutate(game_date = as_date(game_date))


#=========================================================================================#
# Plotting ----
#=========================================================================================#

statcast_data %>% 
    mutate(babip_value = as_factor(babip_value)) %>% 
    filter(launch_speed >= 0 & launch_speed <= 200) %>% 
    ggplot(aes(launch_speed, stat(density))) + 
    geom_histogram(aes(color = babip_value), binwidth = 1)

glm(babip_value ~ launch_speed)
